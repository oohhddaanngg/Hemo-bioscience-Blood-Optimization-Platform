Project Business Logic Manual
This document is the authoritative source for all business rules and logic governing the platform.

1. Core Purpose
The platform is a web-based inventory management, optimization, and forecasting system. Its primary goals are to reduce Red Blood Cell (RBC) purchasing costs and minimize waste by identifying sharing opportunities and optimizing inventory usage.

2. Versioning
Each iteration of the single-page application's HTML file must be versioned using semantic versioning (e.g., v0.7.3). The version number must be updated in the file's <title> tag and in the visible version badge in the UI header.

3. User Management
The platform is designed for a single primary user per browser instance. The user's name is stored in local storage to tag all activities and changes.

4. Data & UI Principles

Data Persistence: All application data is stored locally within the user's web browser in a transactional database called IndexedDB. This method is robust and ensures data persists between sessions, browser restarts, and computer reboots. Every change made by the user is immediately saved to this database, minimizing the risk of data loss.

Single Source of Truth: APP_STATE is the definitive source of all data. All user-facing UI elements (tables, dropdowns, forms) MUST be populated dynamically from this object.

UI State on Load: All data-driven UI elements MUST be fully populated and rendered correctly upon initial application load (DOMContentLoaded). No user interaction shall be required to display existing data.

Data-Driven UI: The PT Customers list serves as the single source of truth for all customer-selection UI elements. Any dropdown for selecting a customer must be populated exclusively and dynamically from this list. Hardcoding of data lists in the HTML is strictly prohibited.

5. Backup and Restore

Mechanism: The platform's primary backup mechanism is a manual export process.

Exporting Data: From the "Settings" -> "Backup & Data Management" panel, the user can export the entire application's data to a single JSON file. This file is the official backup record.

Backup Filename: Exported files will be named using the convention: blood_platform_data_backup_YYYY-MM-DD_HHMMSS.json.

Restoring Data: The user can import a previously exported JSON backup file. This action will completely overwrite all existing data in the browser's database with the content from the file. A confirmation prompt will be displayed before this irreversible action is executed.

6. Data Imports

CSV Imports: Data for Sample Definitions, Historical Specifications, and Order Quantities can be imported from CSV files.

Duplicate Detection: All CSV import functions must perform duplicate detection. Records from an imported CSV file that already exist in the database will be skipped.

Unique Identifiers:

Sample Definitions: The unique key is sample_type_id.

Specifications & Quantities: The unique key is a composite of customer, event, year, and sample_id.

User Feedback: After a CSV import is complete, the application must display a message to the user indicating the number of new records successfully imported and the number of duplicate records that were skipped.

7. Blood Calculation Logic

Base Formula: pRBC Volume = (Quantity + 5 retention samples) × Sample Volume (mL) × (Hematocrit % / 100)

Overage Tiers (Standard):

<200 samples: 15% overage

200-1000 samples: 10% overage

1001-2000 samples: 8% overage

2000 samples: 6% overage

Special Overage (Overrides Standard):

DAT Positive (IgG/C3) & Eluate samples: 30% overage

8. Vision Clarification
The platform is an efficiency and decision-support tool. Its outputs (like the BUP) are intended to inform decisions and increase efficiency, not to serve as final, regulated manufacturing documents.
